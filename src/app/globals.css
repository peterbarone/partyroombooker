@tailwind base;
@tailwind components;
@tailwind utilities;

/* ---------- Root tokens (colors, layout) ---------- */
:root {
  /* Core brand (lighter purple) */
  --wizzy-purple-50:#F1EDFF;
  --wizzy-purple-100:#E6E0FF;
  --wizzy-purple-200:#D4CBFF;
  --wizzy-purple-300:#BDAEFF;
  --wizzy-purple-400:#A695F0; /* primary */
  --wizzy-purple-500:#8E7AD9;
  --wizzy-purple-600:#765FC1;
  --wizzy-purple-700:#5E4AA7;

  /* Portal accent (glows, active states) */
  --portal-50:#EAF7FF;
  --portal-200:#BFE6FF;
  --portal-400:#76C7FF;
  --portal-500:#4FAEF2;

  /* Parchment + inks */
  --parchment-50:#FFFCF6;
  --parchment-100:#FFF8E9; /* main card */
  --parchment-200:#F6EED9; /* borders/stripes */
  --ink-700:#5A3F2B;       /* headings */
  --ink-600:#6B4C34;       /* body */
  --ink-500:#7C5A3E;       /* secondary */

  /* Wood accents (signs) */
  --wood-600:#6F4B2A;
  --wood-700:#5D3E22;

  /* Status */
  --ok-500:#62D497;
  --warn-500:#E6B25C;
  --danger-500:#E06C6C;

  /* Layout tokens */
  --rail: clamp(20rem, 92vw, 36rem);
  --gap: clamp(0.75rem, 1.5vw, 1rem);
  --hud-h: clamp(52px, 8vw, 72px);
  --nav-h: clamp(64px, 9vw, 88px);
  --ctl: clamp(64px, 8vw, 88px);
  --fz-100: clamp(12px, 1.5vw, 14px);
  --fz-200: clamp(14px, 1.8vw, 16px);
  --fz-300: clamp(16px, 2.1vw, 18px);
  --fz-400: clamp(18px, 2.6vw, 22px);
}

/* ---------- Global base ---------- */

/* Always box-border */
*, *::before, *::after { box-sizing: border-box; }

/* Background world */
html, body { min-height: 100%; }
body {
  background-image: url('/app-background.png');
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  background-attachment: fixed;
  background-color: #FFEBD5; /* soft cream fallback */
  font-family: 'Chewy', sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
  color: var(--ink-700);
}

/* Global vignette overlays */
body::before,
body::after {
  content: "";
  position: fixed;
  left: 0; right: 0;
  height: 18vh;
  pointer-events: none;
  z-index: 20;
}
body::before {
  top: 0;
  background: linear-gradient(to bottom,
    rgba(0,0,0,.38) 0%,
    rgba(0,0,0,.28) 25%,
    rgba(0,0,0,.12) 60%,
    rgba(0,0,0,0) 100%);
}
body::after {
  bottom: 0;
  background: linear-gradient(to top,
    rgba(0,0,0,.38) 0%,
    rgba(0,0,0,.28) 25%,
    rgba(0,0,0,.12) 60%,
    rgba(0,0,0,0) 100%);
}

/* Prevent horizontal scroll globally */
html, body, #__next { overflow-x: hidden; }

/* Root scroll lock: page itself never scrolls; use .scroll-area per screen */
html, body, #__next {
  height: 100%;
  overflow-y: hidden;
  overscroll-behavior: none;
}

/* Safe full-height helper */
.h-screen-safe { height: 100dvh; }
@supports not (height: 100dvh) {
  .h-screen-safe { height: 100vh; }
}

/* The only scrollable region inside each page */
.scroll-area {
  overflow-y: auto;
  overflow-x: clip;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
  scrollbar-gutter: stable both-edges;
}
.scroll-area > * { max-inline-size: 100%; }

/* Rail container (single source of truth) */
.hud-rail {
  container-type: inline-size;
  inline-size: min(100%, var(--rail));
  max-inline-size: var(--rail);
}

/* ---------- Animations (base) ---------- */
@keyframes bounce-fun {
  0%,20%,53%,80%,100% { transform: translate3d(0,0,0); }
  40%,43% { transform: translate3d(0,-10px,0); }
  70% { transform: translate3d(0,-5px,0); }
  90% { transform: translate3d(0,-2px,0); }
}
@keyframes wiggle {
  0%,7% { transform: rotateZ(0); }
  15% { transform: rotateZ(-15deg); }
  20% { transform: rotateZ(10deg); }
  25% { transform: rotateZ(-10deg); }
  30% { transform: rotateZ(6deg); }
  35% { transform: rotateZ(-4deg); }
  40%,100% { transform: rotateZ(0); }
}
@keyframes float {
  0% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0); }
}
@keyframes spin { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
@keyframes rotate {
  from { transform: translate(-50%, -50%) rotate(0deg); }
  to   { transform: translate(-50%, -50%) rotate(360deg); }
}
@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
@keyframes sparkle {
  0%,100% { opacity:0; transform:scale(0); }
  50% { opacity:1; transform:scale(1); }
}

/* ---------- UTILITIES LAYER ---------- */
@layer utilities {
  /* Parchment backgrounds as utilities (apply last; won’t be overridden by bg-*) */
  .bg-parchment {
    background:
      radial-gradient(1200px 800px at 20% 0%, rgba(255,255,255,.55), transparent 60%),
      radial-gradient(900px 700px at 100% 100%, rgba(255,244,220,.4), transparent 50%),
      linear-gradient(180deg, var(--parchment-50) 0%, var(--parchment-100) 100%);
  }
  .bg-parchment-texture {
    background-color: var(--parchment-100);
    background-image:
      radial-gradient(rgba(0,0,0,.035) 1px, transparent 1px),
      radial-gradient(rgba(0,0,0,.03) 1px, transparent 1px),
      linear-gradient(180deg, var(--parchment-50), var(--parchment-100));
    background-size: 12px 12px, 18px 18px, 100% 100%;
    background-position: 0 0, 4px 6px, 0 0;
    backdrop-filter: saturate(110%);
  }

  .hud-top { height: var(--hud-h); }
  .hud-bottom { height: calc(var(--nav-h) + env(safe-area-inset-bottom)); }
  .btn-icon { width: var(--ctl); height: var(--ctl); background-repeat:no-repeat; background-size:contain; background-position:center; }
  .animate-bounce-fun { animation: bounce-fun 2s infinite; }
  .animate-wiggle { animation: wiggle 2s ease-in-out infinite; }
  .animate-float { animation: float 3s ease-in-out infinite; }
  .spinner-party { border:4px solid #f3f3f3; border-top:4px solid var(--wizzy-purple-400); border-radius:50%; width:40px; height:40px; animation: spin 1s linear infinite; }

  /* Aspect helper (portal crops) */
  .aspect-portal { position: relative; width:100%; padding-top: calc(100% * 9 / 3); }
  .aspect-portal > * { position:absolute; inset:0; }

  /* Allow using theme(colors.portal.400) in arbitrary gradients */
  .bg-portal-400\/40 { background-color: color-mix(in oklab, var(--portal-400), transparent 60%); }

  /* ConfettiOrbCounter animations/utilities */
  .animate-numberPulse { animation: numberPulse .28s ease-out; }
  .animate-orbSwirl { animation: orbSwirl 10s linear infinite; }
  .animate-orbTwinkles { animation: orbTwinkles 2.4s ease-in-out infinite; }

  @media (prefers-reduced-motion: reduce) {
    .animate-orbSwirl { animation: none; }
    .animate-orbTwinkles { animation: none; }
  }

  /* confetti particles */
  .confetti-particle {
    position: absolute;
    top: 50%; left: 50%;
    width: 6px; height: 6px; border-radius: 9999px;
    background: radial-gradient(circle, #fff 0 45%, transparent 46%);
    box-shadow: 0 0 0 2px rgba(255,255,255,.25) inset;
    opacity: 0;
    transform: translate(-50%, -50%);
    will-change: transform, opacity;
  }
  .confetti-burst .confetti-particle:nth-child(odd)  { background-color: #ffd166; }
  .confetti-burst .confetti-particle:nth-child(even) { background-color: #ff80bf; }
  .confetti-burst .confetti-particle { animation: confettiPop 420ms ease-out forwards; }
  @media (prefers-reduced-motion: reduce) {
    .confetti-burst .confetti-particle { animation: none; }
  }
}

@keyframes numberPulse {
  0% { transform: scale(1); text-shadow: 0 0 0 rgba(255,255,255,0); }
  35% { transform: scale(1.14); text-shadow: 0 6px 18px rgba(255,255,255,.45); }
  100% { transform: scale(1); text-shadow: 0 0 0 rgba(255,255,255,0); }
}
@keyframes orbSwirl {
  0% { transform: rotate(0deg); filter: hue-rotate(0deg) brightness(1); }
  100% { transform: rotate(360deg); filter: hue-rotate(10deg) brightness(1.02); }
}
@keyframes orbTwinkles {
  0%, 100% { opacity: .25; transform: scale(1); }
  50% { opacity: .45; transform: scale(1.02); }
}
@keyframes confettiPop {
  0%   { opacity: 0; transform: translate(-50%, -50%) rotate(var(--th)) translateX(0) scale(.6); }
  10%  { opacity: 1; }
  100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--th)) translateX(70px) translateY(-8px) scale(1); }
}

/* ---------- COMPONENTS LAYER ---------- */
@layer components {
  /* Headline style for wood sign titles */
  .app-headline {
    font-family: 'Chewy', sans-serif;
    color: #FF8F1F;
    -webkit-text-stroke: 2px #36454F;
    font-size: 1.5rem;
    line-height: 1.1;
    font-weight: 900;
    letter-spacing: -0.02em;
  }

  /* Buttons */
  .btn-primary {
    @apply inline-flex items-center justify-center gap-2 rounded-2xl px-5 py-3
           font-semibold text-white bg-wiz-purple-400 hover:bg-wiz-purple-500
           shadow-lift active:translate-y-[1px] focus:outline-none focus:shadow-glow transition;
  }
  .btn-secondary {
    @apply inline-flex items-center justify-center gap-2 rounded-2xl px-5 py-3
           font-semibold text-wiz-purple-500 bg-white/70 backdrop-blur-sm
           border-2 border-wiz-purple-300 hover:bg-white shadow-parchment focus:shadow-glow transition;
  }

  /* Cards */
  .card {
    @apply bg-parchment bg-parchment-texture rounded-3xl border border-wiz-parchment-200 shadow-parchment;
  }
  .card-hover {
    @apply transition hover:border-wiz-purple-300 hover:shadow-lift;
  }
  .card-selected {
    @apply border-2 border-wiz-purple-400 ring-4 ring-wiz-portal-200 shadow-portal;
  }

  /* Inputs */
  .form-label { @apply block mb-1 text-wiz-ink-700; }
  .input {
    background-color: var(--wizzy-purple-400);
    color: white;
    border: 2px solid #6F4624;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
    @apply w-full rounded-2xl px-5 py-4 md:px-8 md:py-5
           outline-none transition
           hover:shadow-lift focus:shadow-glow;
    backdrop-filter: saturate(115%) blur(1px);
    -webkit-appearance: none;
    appearance: none;
    background-clip: padding-box;
  }
  /* Custom scrollbars */
  .scrollable::-webkit-scrollbar {
    width: 12px;
  }
  .scrollable::-webkit-scrollbar-track {
    background: var(--wizzy-purple-400);
    border-radius: 10px;
  }
  .scrollable::-webkit-scrollbar-thumb {
    background: linear-gradient(90deg, #00d9ff 0%, #00b4d8 25%, #0096c7 50%, #00b4d8 75%, #00d9ff 100%);
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,217,255,0.5);
  }
  .scrollable::-webkit-scrollbar-thumb:hover {
    box-shadow: 0 0 15px rgba(0,217,255,0.8);
  }
  .input:-webkit-autofill:hover,
  .input:-webkit-autofill:focus {
    -webkit-text-fill-color: var(--ink-700);
    -webkit-box-shadow: 0 0 0px 1000px transparent inset;
    transition: background-color 99999s ease-in-out 0s;
    caret-color: var(--ink-700);

  }

  /* Capacity/Info pill */
  .pill {
    @apply inline-flex items-center gap-2 rounded-full px-3 py-1
           bg-wiz-parchment-200 border border-wiz-parchment-200 text-wiz-ink-600 text-sm;
  }

  /* Back/Next circular nav buttons (image or solid) */
  .nav-circle-btn {
    position: relative; display:inline-flex; align-items:center; justify-content:center;
    width: 88px; height: 88px; border-radius: 9999px;
    background: #4b3a7a; border: 4px solid #3f3167;
    box-shadow: 0 6px 12px rgba(0,0,0,.15) inset, 0 4px 10px rgba(0,0,0,.12);
    color:#111; transition: transform .15s ease, box-shadow .15s ease, opacity .15s ease;
  }
  .nav-circle-btn:hover { transform: scale(1.03); box-shadow: 0 6px 12px rgba(0,0,0,.2) inset, 0 6px 14px rgba(0,0,0,.18); }
  .nav-circle-btn:active { transform: scale(0.98); }
  .nav-img-btn { display:inline-block; width:110px; height:110px; background-size:contain; background-position:center; background-repeat:no-repeat; transition: transform .15s ease; }
  .nav-img-btn:hover { transform: scale(1.03); }
  .nav-img-btn:active { transform: scale(0.98); }
  .nav-img-btn--back { background-image: url('/partyback.png'); }
  .nav-img-btn--next { background-image: url('/partynext.png'); }

  @media (min-width: 640px) {
    .nav-circle-btn { width: 96px; height: 96px; }
    .nav-img-btn { width:128px; height:128px; }
  }

  /* Hanging wooden sign */
  .hanging-sign { position: relative; margin-top:12px; width:98%; max-width:800px; }
  .rope-left, .rope-right {
    position:absolute; top:-30px; width:3px; height:40px;
    background: linear-gradient(to bottom, #4a3f35 0%, #5c4f42 50%, #4a3f35 100%);
    box-shadow: 1px 0 2px rgba(0,0,0,.5);
  }
  .rope-left { left:15%; transform: rotate(-2deg); }
  .rope-right { right:15%; transform: rotate(2deg); }
  .wood-sign {
    background: linear-gradient(135deg, #6b4423 0%, #8b5a2b 20%, #6b4423 40%, #8b5a2b 60%, #6b4423 80%, #8b5a2b 100%);
    padding:16px 28px; border-radius:8px;
    box-shadow: 0 8px 25px rgba(0,0,0,.6), inset 0 2px 5px rgba(255,255,255,.1), inset 0 -3px 8px rgba(0,0,0,.4);
    position:relative; border:3px solid #4a3018; transform-origin:center top; animation: swing 3s ease-in-out infinite;
  }
  @keyframes swing { 0%,100%{transform:rotate(-2deg)} 50%{transform:rotate(2deg)} }
  .wood-sign::before {
    content:''; position:absolute; inset:0;
    background: repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0,0,0,.1) 2px, rgba(0,0,0,.1) 4px);
    pointer-events:none; border-radius:5px;
  }
  .sign-title {
    color:#f5deb3; font-size:1.5rem; font-weight:800; text-align:center;
    text-shadow: 2px 2px 4px rgba(0,0,0,.8), 0 0 10px rgba(245,222,179,.3);
    font-family:'Chewy', sans-serif; letter-spacing:1px; position:relative; z-index:1;
  }
  .nail { position:absolute; width:10px; height:10px; background: radial-gradient(circle at 30% 30%, #888, #444); border-radius:50%; box-shadow: inset -1px -1px 2px rgba(0,0,0,.5), 0 2px 4px rgba(0,0,0,.6); }
  .nail-tl { top:12px; left:18px; } .nail-tr { top:12px; right:18px; }
  .nail-bl { bottom:12px; left:18px; } .nail-br { bottom:12px; right:18px; }

  /* Progress bar (stone frame + portal fill) */
  .progress-container { width:98%; max-width:800px; position:relative; }
  .stone-frame {
    background: linear-gradient(135deg, #8b7355 0%, #a89276 50%, #8b7355 100%);
    padding:12px; border-radius:20px;
    box-shadow: 0 10px 30px rgba(0,0,0,.5), inset 0 2px 5px rgba(255,255,255,.2), inset 0 -2px 5px rgba(0,0,0,.3);
    position:relative;
  }
  .stone-frame::before {
    content:''; position:absolute; top:8px; left:8px; right:8px; bottom:8px;
    border:2px solid rgba(139,115,85,.5); border-radius:15px; pointer-events:none;
  }
  .progress-bg {
    background: linear-gradient(135deg, #0a4d68 0%, #05668d 50%, #0a4d68 100%);
    height:30px; border-radius:10px; position:relative; overflow:hidden;
    box-shadow: inset 0 5px 15px rgba(0,0,0,.4);
  }
  .spiral-bg {
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    width:150px; height:150px;
    background: radial-gradient(circle at center, transparent 0%, rgba(255,255,255,.03) 20%, transparent 40%, rgba(255,255,255,.03) 60%, transparent 80%);
    animation: rotate 8s linear infinite; opacity:.6;
  }
  .progress-fill {
    height:100%;
    background: linear-gradient(90deg, #00d9ff 0%, #00b4d8 25%, #0096c7 50%, #00b4d8 75%, #00d9ff 100%);
    background-size:200% 100%; border-radius:8px; position:relative;
    transition: width .3s ease; box-shadow: 0 0 20px rgba(0,217,255,.5), inset 0 2px 10px rgba(255,255,255,.3);
    animation: shimmer 2s linear infinite;
  }
  .sparkles { position:absolute; inset:0; pointer-events:none; }
  .sparkle { position:absolute; width:3px; height:3px; background:white; border-radius:50%; animation: sparkle 2s ease-in-out infinite; box-shadow:0 0 6px rgba(255,255,255,.8); }
  .progress-text { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:white; font-weight:bold; font-size:18px; text-shadow:0 2px 4px rgba(0,0,0,.8); z-index:10; }
}

/* ---------- RESPONSIVE TEXT TWEAK ---------- */
@container (min-width: 30rem) {
  .hud-title { font-size: var(--fz-400); }
}

@layer components {
  .input {
    background-color: var(--wizzy-purple-400);
    color: white;
    border: 2px solid #6F4624;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
    @apply w-full rounded-2xl px-4 py-3
           outline-none transition
           focus:shadow-glow;
    -webkit-appearance: none;              /* reset iOS/Chrome */
    appearance: none;
    background-clip: padding-box;
  }
  .input::placeholder {
    color: #E6E0FF;
  }

  /* tame iOS/Chrome autofill “yellow” and white repaint */
  input:-webkit-autofill,
  input:-webkit-autofill:hover,
  input:-webkit-autofill:focus {
    -webkit-text-fill-color: var(--ink-700);
    -webkit-box-shadow: 0 0 0px 1000px transparent inset; /* keep parchment visible */
    transition: background-color 99999s ease-in-out 0s;
    caret-color: var(--ink-700);
  }
}

@layer components {
  /* Responsive character: prefers container units, falls back to vw */
  .hud-char {
    position: absolute;
    pointer-events: none;
    user-select: none;
    height: auto;

    /* Fallbacks (SSR-safe): vw + rem/px variables */
    width: var(--char-w-vw, clamp(130px, 18vw, 300px));
    inset-block-end: var(--char-b, 6rem);
    transform: translate(var(--char-tx, 0), var(--char-ty, 0)) scale(var(--char-scale, 1));
    transform-origin: var(--char-origin, 50% 100%); /* pivot = center bottom */
  }

  .hud-char[data-anchor="left"]  { inset-inline-start: var(--char-x, 8%); }
  .hud-char[data-anchor="right"] { inset-inline-end:   var(--char-x, 8%); }

  /* Prefer container queries when available; .hud-rail already sets container-type */
  @supports (width: 1cqw) {
    .hud-char {
      width: var(--char-w-cq, clamp(130px, 22cqw, 260px));
      /* Use container-query floor when provided, else fall back to rem-based --char-b */
      inset-block-end: var(--char-b-cq, var(--char-b, 6rem));
    }
  }

  /* Optional: gentle size tuning by container width (uses your .hud-rail) */
  @container (min-width: 700px) {
    .hud-char[data-size="md"] { --char-w-cq: clamp(140px, 20cqw, 300px); }
  }
  @container (min-width: 1100px) {
    .hud-char[data-size="md"] { --char-w-cq: clamp(160px, 18cqw, 340px); }
  }
}
